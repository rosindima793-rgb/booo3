# CrazyOctagon Smart Bot üêô

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –±–æ—Ç –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ü–µ–Ω –∏ —Ç–æ—Ä–≥–æ–≤–ª–∏ –Ω–∞ Monad testnet.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### 1. –£–º–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω (Anti-Dump)
- **–†–æ—Å—Ç —Ü–µ–Ω—ã ‚Üí –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–π push** –≤ –∫–æ–Ω—Ç—Ä–∞–∫—Ç (–µ—Å–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–µ > 5%)
- **–ü–∞–¥–µ–Ω–∏–µ —Ü–µ–Ω—ã ‚Üí –∑–∞–¥–µ—Ä–∂–∫–∞ 1 —á–∞—Å**:
  - –ï—Å–ª–∏ —Ü–µ–Ω–∞ —Å—Ç–∞–±–∏–ª–∏–∑–∏—Ä–æ–≤–∞–ª–∞—Å—å (¬±5%) ‚Üí push
  - –ï—Å–ª–∏ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –ø–∞–¥–∞—Ç—å ‚Üí —Ñ–æ—Ä—Å-—Å–Ω–∏–∂–µ–Ω–∏–µ (–º–∞–∫—Å 15% –∑–∞ —à–∞–≥)
- –ê–ª–≥–æ—Ä–∏—Ç–º –∏–∑ `monahapanceeeebot` ‚Äî –∑–∞—â–∏—Ç–∞ –æ—Ç –¥–∞–º–ø–∞

### 2. –†–∞–Ω–¥–æ–º–Ω–∞—è —Ç–æ—Ä–≥–æ–≤–ª—è
- **7 –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –ø–æ–∫—É–ø–∫–∏**: 10%, 20%, 30%, 40%, 50%, 60%, 70% –æ—Ç –±–∞–∑–æ–≤–æ–π —Å—É–º–º—ã (0.01 MON)
- **6 –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –ø—Ä–æ–¥–∞–∂–∏**: 10%, 20%, 30%, 40%, 50%, 60% –æ—Ç –∫—É–ø–ª–µ–Ω–Ω–æ–≥–æ
- –ü—Ä–æ–¥–∞–∂–∞ –≤—Å–µ–≥–¥–∞ –º–µ–Ω—å—à–µ –ø–æ–∫—É–ø–∫–∏ (–Ω–µ—Ç —Å–∏—Ç—É–∞—Ü–∏–∏ "–Ω–µ—á–µ–≥–æ –ø—Ä–æ–¥–∞–≤–∞—Ç—å")
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ WMON –∏ CRAA

### 3. –¶–µ–Ω—ã —Ç–æ–ª—å–∫–æ —Å PancakeSwap
- –ü–µ—Ä–≤–∏—á–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫: `PANCAKE_FACTORY` (0x82438CE666d9403e488bA720c7424434e8Aa47CD)
- Fallback: —è–≤–Ω—ã–µ –ø—É–ª—ã –∏–∑ `.env`

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
cd bot_local_monad
npm install
```

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–°–∫–æ–ø–∏—Ä—É–π `.env` –∏ –Ω–∞—Å—Ç—Ä–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:

```env
# –û—Å–Ω–æ–≤–Ω—ã–µ –∞–¥—Ä–µ—Å–∞ (—É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã)
RPC_URL=https://testnet-rpc.monad.xyz
NFT_COLLECTION=0x4bcd4aff190d715fa7201cce2e69dd72c0549b07
CRAA_TOKEN=0x7D7F4BDd43292f9E7Aae44707a7EEEB5655ca465
OCTA_TOKEN=0xB4832932D819361e0d250c338eBf87f0757ed800
WMON_TOKEN=0x760AfE86e5de5fa0Ee542fc7B7B713e1c5425701
PANCAKE_FACTORY=0x82438CE666d9403e488bA720c7424434e8Aa47CD

# !!! –î–û–ë–ê–í–¨ –ü–†–ò–í–ê–¢–ù–´–ï –ö–õ–Æ–ß–ò !!!
ORACLE_PK=                    # –ü—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á —Å —Ä–æ–ª—å—é PRICER_ROLE
TRADER_PK=                    # –ü—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è —Ç–æ—Ä–≥–æ–≤–ª–∏ (–∏–ª–∏ —Ç–æ—Ç –∂–µ —á—Ç–æ ORACLE_PK)

# Anti-dump –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ)
MIN_CHANGE_PCT=0.05           # 5% –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ
DECREASE_DELAY_MS=3600000     # 1 —á–∞—Å –∑–∞–¥–µ—Ä–∂–∫–∞ –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏
PENDING_TOL_PCT=0.05          # 5% –¥–æ–ø—É—Å–∫ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏
MAX_STEP_DOWN_PCT=0.15        # 15% –º–∞–∫—Å —Å–Ω–∏–∂–µ–Ω–∏–µ –∑–∞ —à–∞–≥

# –¢–æ—Ä–≥–æ–≤–ª—è
TRADE_MODE=off                # off | on
BASE_TRADE_MON=0.01           # –ë–∞–∑–æ–≤–∞—è —Å—É–º–º–∞ –¥–ª—è –ø–æ–∫—É–ø–∫–∏ (–≤ MON)
TRADE_SLIPPAGE_BPS=500        # 5% slippage
```

## –ó–∞–ø—É—Å–∫

### –õ–æ–∫–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç (dry-run):
```bash
node push_prices.js
```

### –†–µ–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ (–ø—Ä–∏–º–µ–Ω—è–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è):
```bash
node push_prices.js --apply
```

## GitHub Actions (–∞–≤—Ç–æ–∑–∞–ø—É—Å–∫ –∫–∞–∂–¥—ã–µ 25 –º–∏–Ω—É—Ç)

### 1. –î–æ–±–∞–≤—å —Å–µ–∫—Ä–µ—Ç—ã –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:
- Settings ‚Üí Secrets and variables ‚Üí Actions ‚Üí New repository secret
  - `ORACLE_PK` ‚Äî –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á –æ—Ä–∞–∫—É–ª–∞
  - `TRADER_PK` ‚Äî –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è —Ç–æ—Ä–≥–æ–≤–ª–∏

### 2. (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –î–æ–±–∞–≤—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:
- Settings ‚Üí Secrets and variables ‚Üí Actions ‚Üí Variables
  - `TRADE_MODE` = `on` (–≤–∫–ª—é—á–∏—Ç—å —Ç–æ—Ä–≥–æ–≤–ª—é)
  - `BASE_TRADE_MON` = `0.01` (—Å—É–º–º–∞ –ø–æ–∫—É–ø–∫–∏)

### 3. Workflow –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- –ö–∞–∂–¥—ã–µ 25 –º–∏–Ω—É—Ç (cron: `*/25 * * * *`)
- –ò–ª–∏ –≤—Ä—É—á–Ω—É—é: Actions ‚Üí CrazyOctagon Price Bot ‚Üí Run workflow

## –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

```mermaid
graph TD
    A[–ó–∞–ø—É—Å–∫ –∫–∞–∂–¥—ã–µ 25 –º–∏–Ω] --> B[Fetch floor –æ—Ç Reservoir]
    B --> C[Fetch CRAA/OCTA —Ü–µ–Ω—ã –æ—Ç PancakeSwap]
    C --> D{–¶–µ–Ω–∞ –≤—ã—Ä–æ—Å–ª–∞ >5%?}
    D -->|–î–∞| E[Push —Å—Ä–∞–∑—É –≤ –∫–æ–Ω—Ç—Ä–∞–∫—Ç]
    D -->|–ù–µ—Ç| F{–¶–µ–Ω–∞ —É–ø–∞–ª–∞ >5%?}
    F -->|–î–∞| G{–ü–µ—Ä–≤–æ–µ –ø–∞–¥–µ–Ω–∏–µ?}
    G -->|–î–∞| H[–ñ–¥–∞—Ç—å 1 —á–∞—Å]
    G -->|–ù–µ—Ç| I{1 —á–∞—Å –ø—Ä–æ—à—ë–ª?}
    I -->|–ù–µ—Ç| H
    I -->|–î–∞| J{–°—Ç–∞–±–∏–ª—å–Ω–æ ¬±5%?}
    J -->|–î–∞| K[Push –Ω–æ–≤—É—é —Ü–µ–Ω—É]
    J -->|–ù–µ—Ç| L[–§–æ—Ä—Å-—Å–Ω–∏–∂–µ–Ω–∏–µ –º–∞–∫—Å 15%]
    F -->|–ù–µ—Ç| M[–ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π]
    
    E --> N{TRADE_MODE=on?}
    K --> N
    L --> N
    M --> N
    N -->|–î–∞| O{–ï—Å—Ç—å –±–∞–ª–∞–Ω—Å CRAA?}
    O -->|–ù–µ—Ç| P[BUY: random 10-70% –æ—Ç 0.01 MON]
    O -->|–î–∞| Q[Random: buy –∏–ª–∏ sell?]
    Q -->|Buy| P
    Q -->|Sell| R[SELL: random 10-60% –æ—Ç –±–∞–ª–∞–Ω—Å–∞]
    N -->|–ù–µ—Ç| S[–°–æ—Ö—Ä–∞–Ω–∏—Ç—å state]
    P --> S
    R --> S
```

## –§–∞–π–ª—ã

- `push_prices.js` ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç
- `.env` ‚Äî –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- `../data/bot_state.json` ‚Äî —Å–æ—Å—Ç–æ—è–Ω–∏–µ (history, pending, trade balance)
- `../data/bot_price_*.json` ‚Äî –ª–æ–≥ —Ü–µ–Ω

## –ü—Ä–∏–º–µ—Ä—ã –≤—ã–≤–æ–¥–∞

### –†–æ—Å—Ç —Ü–µ–Ω—ã:
```
üìà RISE (>5.0%) ‚Üí instant push
üì§ Push (LIVE):
  setManualFloor(520000000000000000)
  setCRARateManual(4266700000000000000000000000)
  Floor tx: 0x123...
  CRAA tx: 0x456...
```

### –ü–∞–¥–µ–Ω–∏–µ (–æ–∂–∏–¥–∞–Ω–∏–µ):
```
‚è≥ FALL ‚Üí wait 60min
```

### –¢–æ—Ä–≥–æ–≤–ª—è:
```
üõí BUY 40% of 0.01 = 0.004000 MON
  Expected: 5021087.234 CRAA
  Tx: 0x789...
  ‚úÖ Bought

üí∞ SELL 30% of 5021087.234 = 1506326.170 CRAA
  Expected: 0.0012 WMON
  Tx: 0xabc...
  ‚úÖ Sold
```

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

‚ö†Ô∏è **–ù–ò–ö–û–ì–î–ê –Ω–µ –∫–æ–º–º–∏—Ç—å `.env` —Å –ø—Ä–∏–≤–∞—Ç–Ω—ã–º–∏ –∫–ª—é—á–∞–º–∏!**

- `.env` —É–∂–µ –≤ `.gitignore`
- –ò—Å–ø–æ–ª—å–∑—É–π GitHub Secrets –¥–ª—è CI/CD
- –ü—Ä–æ–≤–µ—Ä—è–π –±–∞–ª–∞–Ω—Å –∫–æ—à–µ–ª—å–∫–∞ –ø–µ—Ä–µ–¥ –≤–∫–ª—é—á–µ–Ω–∏–µ–º `TRADE_MODE=on`

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–ü—Ä–æ–≤–µ—Ä—è–π –ª–æ–≥–∏ –≤ GitHub Actions:
- Actions ‚Üí CrazyOctagon Price Bot ‚Üí Latest run
- –°–º–æ—Ç—Ä–∏ —Å–µ–∫—Ü–∏—é "Run smart bot" –¥–ª—è –¥–µ—Ç–∞–ª–µ–π

–õ–æ–∫–∞–ª—å–Ω–æ —Å–º–æ—Ç—Ä–∏ `data/bot_state.json`:
```json
{
  "lastCraaAmount": 4266700000,
  "lastOctaAmount": 10428794053,
  "lastPushAt": 1759567907794,
  "trade": {
    "balance": 0.006,
    "craaBalance": 3014652.34,
    "lastAction": "sell"
  },
  "history": [...]
}
```

## Troubleshooting

### "No ORACLE_PK - skipping push"
‚Üí –î–æ–±–∞–≤—å `ORACLE_PK` –≤ `.env` –∏–ª–∏ GitHub Secrets

### "No pair for 0x..."
‚Üí –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ `PANCAKE_FACTORY` –∏ `CRAA_WMON_POOL`/`OCTA_WMON_POOL` –∑–∞–¥–∞–Ω—ã

### "Nothing to sell"
‚Üí –ù–æ—Ä–º–∞–ª—å–Ω–æ, –µ—Å–ª–∏ –±–∞–ª–∞–Ω—Å CRAA = 0. –ë–æ—Ç –ø—Ä–æ–ø—É—Å—Ç–∏—Ç –ø—Ä–æ–¥–∞–∂—É –∏ –∫—É–ø–∏—Ç –≤ —Å–ª–µ–¥—É—é—â–∏–π —Ä–∞–∑

### GitHub Actions –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
‚Üí –ü—Ä–æ–≤–µ—Ä—å cron —Å–∏–Ω—Ç–∞–∫—Å–∏—Å (`*/25 * * * *`) –∏ —á—Ç–æ workflow –≤–∫–ª—é—á—ë–Ω (Actions ‚Üí Enable workflow)

---

**–ì–æ—Ç–æ–≤–æ!** –ë–æ—Ç —É–º–Ω—ã–π, –±–µ–∑–æ–ø–∞—Å–Ω—ã–π, –∏ –≥–æ—Ç–æ–≤ –∫ –¥–µ–ø–ª–æ—é üöÄ

## Daemon (–ª–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ –∫–∞–∂–¥—ã–µ 25 –º–∏–Ω—É—Ç)

–ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –∑–∞–ø—É—Å–∫–∞—Ç—å `push_prices.js --apply` –ª–æ–∫–∞–ª—å–Ω–æ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é –±–µ–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è GitHub Actions, –µ—Å—Ç—å –ø—Ä–æ—Å—Ç–æ–π helper `run_daemon.js`.

–ü—Ä–∏–º–µ—Ä –∑–∞–ø—É—Å–∫–∞ –≤ PowerShell (–≤ –ø–∞–ø–∫–µ `deploy-bot/bot_local_monad`):

```powershell
# –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ .env –Ω–∞—Å—Ç—Ä–æ–µ–Ω —Å RPC –∏ –∫–ª—é—á–∞–º–∏
node run_daemon.js
```

`run_daemon.js` —Å–æ–∑–¥–∞—ë—Ç `daemon.lock` —á—Ç–æ–±—ã –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç—å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∏–Ω—Å—Ç–∞–Ω—Å—ã –∏ –ª–æ–≥–∏—Ä—É–µ—Ç –≤—ã–≤–æ–¥ –≤ `../data/daemon_*.log`.

–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞: –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `systemd`, `pm2` –∏–ª–∏ –¥—Ä—É–≥–æ–π supervisor –∏ —Ö—Ä–∞–Ω–∏—Ç–µ –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ –∫–ª—é—á–∏ –≤ –∑–∞—â–∏—â—ë–Ω–Ω–æ–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ.

